CREATE TABLE PARTICIPATION (
    ID UUID PRIMARY KEY,
    EXAM_ID UUID,
    SUCCESSFUL BOOLEAN,
    TIME TIMESTAMP,
    USER_ID VARCHAR(255),
    FIRST_NAME VARCHAR(255),
    LAST_NAME VARCHAR(255),
    REMAINING_ATTEMPTS INTEGER,
    COMMENT TEXT);

CREATE VIEW LATEST_PARTICIPATION_VIEW AS SELECT
    p1.ID as ID,
    p1.EXAM_ID as EXAM_ID,
    p1.SUCCESSFUL as SUCCESSFUL,
    p1.TIME as TIME,
    p1.USER_ID as USER_ID,
    p1.FIRST_NAME as FIRST_NAME,
    p1.LAST_NAME as LAST_NAME,
    p1.REMAINING_ATTEMPTS as REMAINING_ATTEMPTS,
    p1.COMMENT as COMMENT
FROM PARTICIPATION p1
INNER JOIN (
    SELECT EXAM_ID, USER_ID, max(TIME) AS TIME
    FROM PARTICIPATION
    GROUP BY EXAM_ID, USER_ID
) p2 ON
    p1.EXAM_ID = p2.EXAM_ID AND
    p1.USER_ID = p2.USER_ID AND
    p1.TIME = p2.TIME;

CREATE TABLE QUESTION (
    ID UUID PRIMARY KEY,
    TEXT TEXT,
    CORRECT_OPTION INTEGER,
    EXAM_ID UUID);

CREATE TABLE EXAM_QUESTIONS (
    EXAM_ID UUID,
    QUESTIONS_ID UUID);

CREATE TABLE QUESTION_OPTIONS (
    QUESTION_ID UUID,
    OPTIONS TEXT);

CREATE TABLE EXAM (
    ID UUID,
    OWNER VARCHAR(255),
    TITLE VARCHAR(255),
    TEXT TEXT,
    MAX_ATTEMPTS INTEGER,
    CLOSED BOOLEAN);

INSERT INTO EXAM (ID, OWNER, TITLE, TEXT, MAX_ATTEMPTS, CLOSED) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b8',
    '64d066bb-a799-4904-81dc-0e851bef2a5f',
    'Example Exam',
    'This is an intial exam',
    1,
    false
);

INSERT INTO QUESTION (ID, TEXT, CORRECT_OPTION, EXAM_ID) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b1',
    'Choose the first option',
    0,
    '61383424-73a7-4834-8859-e1e7db9812b8'
);

INSERT INTO QUESTION (ID, TEXT, CORRECT_OPTION, EXAM_ID) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b2',
    'Choose the 2nd option',
    1,
    '61383424-73a7-4834-8859-e1e7db9812b8'
);

INSERT INTO EXAM_QUESTIONS (EXAM_ID, QUESTIONS_ID) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b8',
    '61383424-73a7-4834-8859-e1e7db9812b2'
);

INSERT INTO EXAM_QUESTIONS (EXAM_ID, QUESTIONS_ID) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b8',
    '61383424-73a7-4834-8859-e1e7db9812b1'
);

INSERT INTO QUESTION_OPTIONS (QUESTION_ID, OPTIONS) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b1',
    'First Option'
);

INSERT INTO QUESTION_OPTIONS (QUESTION_ID, OPTIONS) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b1',
    'Other Option'
);

INSERT INTO QUESTION_OPTIONS (QUESTION_ID, OPTIONS) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b2',
    'Other Option'
);

INSERT INTO QUESTION_OPTIONS (QUESTION_ID, OPTIONS) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b2',
    '2nd Option'
);

INSERT INTO PARTICIPATION (ID, EXAM_ID, SUCCESSFUL, TIME, USER_ID, FIRST_NAME, LAST_NAME, REMAINING_ATTEMPTS, COMMENT) VALUES (
    '61383424-73a7-4834-8859-e1e7db9812b3',
    '61383424-73a7-4834-8859-e1e7db9812b8',
    true,
    now(),
    '61383424-73a7-4834-8859-e1e7db9812b4',
    'Testing',
    'Tester',
    1,
    'This is a default successful attempt'
);
